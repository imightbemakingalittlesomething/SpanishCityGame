<!DOCTYPE html>
<html>
<head>
  <title>Anthropology Game</title>
  <style>
      body { background-color: #9bbfd4;  font-family: Optima; text-align: center; margin-top: 50px; }
        button { display: block; margin: 10px auto; padding: 10px; font-size: 16px; }
  </style>
</head>
<body onload="startGame()">

  <!-- Main Menu -->
  <div id="mainMenu" class="screen">
    <h1>Will You Be the One to Save Us?</h1>
    <button onclick="goTo('economyScreen')">Economy</button>
    <button onclick="goTo('societyScreen')">Society</button>
    <button onclick="goTo('desperationScreen')">Desperation Mode</button>
    <button onclick="goTo('justiceScreen')">Justice</button>

<button onclick="clearLog()">Clear Log</button>

  </div>

  <!-- Economy Screen -->
  <div id="economyScreen" class="screen">
    <h2>Economy</h2>
    <p>Money: <span id="moneyDisplay"></span></p>
    <button onclick="placeFarm()">Build Government Farm (Cost: 100)</button>
    <button onclick="placeMarket()">Open Market (Cost: 80)</button>
    <button onclick="placeFactory()">Build Factory ($200)</button>


    
    <br><br>
    <button onclick="goTo('mainMenu')">Back</button>
  </div>

  <!-- Society Screen -->
  <div id="societyScreen" class="screen">
    <h2>Society</h2>
    <p>Morale: <span id="moraleDisplay"></span></p>
    <p>Health: <span id="healthDisplay"></span></p>
    <p>Schools: <span id="schoolCountDisplay"></span></p>
    <p>Education: <span id="educationDisplay"></span></p>
    <p>Crime: <span id="crimeDisplay"></span></p>
    <p>Wealth: <span id="wealthDisplay"></span></p>
    <p>Workers Abroad: <span id="abroadWorkersDisplay"></span></p>
<p>Empowerment: <span id="empowermentDisplay"></span></p>
    <p>Radicalization: <span id="radicalizationDisplay"></span></p>
     <p>Prisons: <span id="prisonCountDisplay"></span></p>
  <p>Prison Capacity: <span id="prisonCapacityDisplay"></span></p>
  <p>Prisoners: <span id="prisonersDisplay"></span></p>
<p>Risk Level: <span id="riskDisplay"></span></p>
<p>Stability Research: <span id="stabilityDisplay"></span></p>
<p>Home Life: <span id="homeLifeDisplay"></span></p>
<small>(Improves when morale, health, and safety are good)</small>



    <button onclick="renderPlacementMenu('Clinic')">Place Clinic</button>
<button onclick="renderPlacementMenu('School')">Place School</button>

    <button onclick="placePoliceStation()">Build Police Station (Cost: 100)</button>
    <button onclick="renderNeighborhoodSummary()">Neighborhood Status</button>

<button onclick="renderPlacementMenu('School')">Place School</button>
<button onclick="renderPlacementMenu('Park')">Place Park</button>
<button onclick="renderPlacementMenu('Museum')">Place Museum</button>
<button onclick="renderPlacementMenu('Restaurant')">Place Restaurant</button>

    <br><br>
    <button onclick="goTo('mainMenu')">Back</button>
  </div>

  <!-- Desperation Screen -->
  <div id="desperationScreen" class="screen">
    <h2>Desperation Mode</h2>
    <p>Your nation is struggling. These are last-resort options.</p>
    <button onclick="sellArtifacts()">Sell Precious Artifacts (+200 money, morale -10)</button>
    <button onclick="legalizeHeroin()">Legalize Heroin (+300 money, health -15)</button>
    <button onclick="sendWorkersAbroad()">Send Workers Abroad</button>
<button onclick="renderCitizenList()">View Citizens</button>

    <br><br>
    <button onclick="goTo('mainMenu')">Back</button>
  </div>

<div id="eventPanel" class="screen">
  <h2 id="eventTitle"></h2>
  <p id="eventDescription"></p>
  <button id="option1Btn"></button>
  <button id="option2Btn"></button>
  <button id="option3Btn" style="display: none;"></button>
</div>

<div id="justiceScreen" class="screen">
  <h2>Justice System</h2>
  <p>Prisons: <span id="prisonCountDisplay"></span></p>
  <p>Prison Capacity: <span id="prisonCapacityDisplay"></span></p>
  <p>Prisoners: <span id="prisonersDisplay"></span></p>
  <button onclick="placePrison()">Build Prison (Cost: $200)</button>
  <br><button onclick="renderPlacementMenu('Prison')">Place Prison</button>
<br>
  <button onclick="goTo('mainMenu')">Back</button>
</div>
<div id="citizenScreen" class="screen">
  <div id="citizenContent"></div>
</div>

<div id="placementMenu"></div>


<div id="logBox" style="border: 1px solid black; padding: 10px; height: 100px; overflow-y: auto;">
  <strong>Log:</strong><br>
  <div id="logMessages"></div>
</div> 
<div id="citizenLogBox" style="border: 1px solid #444; padding: 10px; margin-top: 10px; height: 100px; overflow-y: auto;">
  <strong>Citizen Voices:</strong><br>
  <div id="citizenLogMessages"></div>
</div>
<div id="app"></div>

  <script defer>
    let money = 500;
let morale = 60;
let displayMorale = Math.round(morale);
let clinicCount = 1;
let health = 70;
let homeLife = 50;
let prisonCount = 1;
let prisonCapacity = 0;
let prisoners = 10; // start with some
let releasedPrisoners = 0;
let radicalization = 1;
let risk = 1;                 // 0–100 scale maybe
let stabilityResearch = 1;    // points you've earned
let abroadWorkers = 0;
let empowerment = 0;
let citizens = [
  {
    id: 1,
    name: "Lina Ortega",
    tags: ["poor", "hopeful", "pianist"],
    stats: {
      morale: 14,
      homeLife: 12,
      radicalization: 9,
      education: 11,
      health: 13
    },
    image: "images/lina.png",
    bio: "Lina plays piano at the community center. She dreams of becoming a teacher one day."
  },
  {
    id: 2,
    name: "Marco Ruiz",
    tags: ["middle class", "angry", "veteran"],
    stats: {
      morale: 10,
      homeLife: 11,
      radicalization: 16,
      education: 12,
      health: 14
    },
    image: "images/marco.png",
    bio: "Marco served in the border guard before the economic crash. He’s frustrated with how things turned out."
  },
  // Add more citizens as needed
];

  // Add as many as you like
 
let neighborhoods = [
  { name: "South Block", class: "poor", schools: 0, prisons: 0 , buildings: [] },
  { name: "Central Heights", class: "middle", schools: 0, prisons: 0 , buildings: [] },
  { name: "Skyview Towers", class: "rich", schools: 0, prisons: 0 , buildings: [] }
];

// New stats
let schoolCount = 0;
let education = 50;
let educationCapacity = 0;
let population = 120; // Or however many people you're tracking

let crime = 40;    // lower is better
let wealth = 45;
let farmCount = 0;
let rehabCount = 0;
let factoryCount = 0;


    function startGame() {
      goTo('mainMenu');
      setInterval(triggerRandomBadEvent, 30000); // 30000 ms = 30 seconds
     setInterval(gameTick, 20000); // Runs every 20 seconds


 


      updateDisplay();
    }

    function goTo(screenId) {
      let screens = document.querySelectorAll('.screen');
      for (let i = 0; i < screens.length; i++) {
        screens[i].style.display = 'none';
      }
      document.getElementById(screenId).style.display = 'block';
    }

  function updateDisplay() {
  document.getElementById("moneyDisplay").textContent = money;
document.getElementById("moraleDisplay").textContent = Math.round(morale);
  document.getElementById("healthDisplay").textContent = health;
  document.getElementById("crimeDisplay").textContent = crime;
  document.getElementById("wealthDisplay").textContent = wealth;
  document.getElementById("prisonCountDisplay").textContent = prisonCount;
  document.getElementById("prisonCapacityDisplay").textContent = prisonCapacity;
  document.getElementById("prisonersDisplay").textContent = prisoners;
  document.getElementById("schoolCountDisplay").textContent = schoolCount;
  document.getElementById("educationDisplay").textContent = education;
document.getElementById("radicalizationDisplay").textContent = radicalization;
document.getElementById("riskDisplay").textContent = Math.floor(risk);
document.getElementById("stabilityDisplay").textContent = stabilityResearch;
document.getElementById("homeLifeDisplay").textContent = Math.floor(homeLife);
document.getElementById("abroadWorkersDisplay").textContent = abroadWorkers;
document.getElementById("empowermentDisplay").textContent = empowerment;


}


    function buildFarm() {
      if (money >= 100) {
        money -= 100;
        money += 50; // immediate return
        farmCount += 1;
        morale += 2;
        logMessage("You built a farm! Productivity increased.");
        updateDisplay();
      } else {
        logMessage("Not enough money!");
      }
    }
    function generateFarmIncome() {
  let income = farmCount * 25;
  money += income;
}

function logMessage(msg) {
  let log = document.getElementById("logMessages");
  let time = new Date().toLocaleTimeString();
log.innerHTML += `[${time}] ${msg}<br>`;
  log.scrollTop = log.scrollHeight; // auto-scroll to newest
}

    function buildClinic() {
      if (money >= 150) {
        money -= 150;
        health += 10;
        morale += 3;
            clinicCount += 1;

        logMessage("You built a clinic! Health and morale improved.");
        updateDisplay();
      } else {
        logMessage("Not enough money!");
      }
    }
function checkClinicCapacity() {
  let clinicCapacity = clinicCount * 25;
  if (population > clinicCapacity) {
    health -= 5;
    logMessage("Your clinics are overcrowded. Health dropped.");
  }
}

    function sellArtifacts() {
      money += 200;
      morale -= 10;
      logMessage("You sold priceless artifacts. The nation is richer, but people are sad.");
      updateDisplay();
    }

    function legalizeHeroin() {
      money += 300;
      health -= 15;
      logMessage("You legalized heroin. Income rises, but health suffers.");
      updateDisplay();
    }

function placeSchool(neighborhoodIndex) {
  let neighborhood = neighborhoods[neighborhoodIndex];
  if (money >= 120) {
    money -= 120;
    neighborhood.buildings.push("school");
    schoolCount += 1;
    educationCapacity += 30;
    morale += 4;
    education += 10;

    if (neighborhood.type === "poor") {
      education += 2; // Bonus effect
    }

    logMessage("Education and Morale has increased. You built a school in " + neighborhood.name);
    updateDisplay();
  } else {
    logMessage("Not enough money!");
  }
}


function updateEducation() {
  if (population === 0) return; // avoid dividing by 0

  let coverage = educationCapacity / population;
  let quality = Math.min(coverage * (homeLife / 100), 1);
education += Math.floor(quality * 5);
  if (coverage > 1) coverage = 1;

  let gain = Math.floor(coverage * 5); // max gain = +5
  education += gain;

  // Optional: penalize if coverage is bad
  if (coverage < 0.5) {
    morale -= 1;
    logMessage("Overcrowded schools! Education quality is low.");
  }
}


function buildPoliceStation() {
  if (money >= 100) {
    money -= 100;
    crime -= 8;
    morale += 1;
    logMessage("You built a police station! Crime went down.");
    updateDisplay();
  } else {
    logMessage("Not enough money!");
  }
}

function openMarket() {
  if (money >= 80) {
    money -= 80;
    money += 40;
    wealth += 6;
    morale += 1;
    logMessage("You opened a market! Wealth and morale improved.");
    updateDisplay();
  } else {
    logMessage("Not enough money!");
  }
}

function buildFactory() {
  if (money >= 200) {
    money -= 200;
    factoryCount += 1;
    logMessage("You built a factory!");
    updateDisplay();
  } else {
    logMessage("Not enough money!");
  }
}
function generateFactoryIncome() {
  let maxEffective = Math.floor(population / 10);
  let activeFactories = Math.min(factoryCount, maxEffective);
  let income = activeFactories * 50;
  money += income;

  if (factoryCount > maxEffective) {
    logMessage("Too many factories! Some are sitting unused.");
  }
}




function buildRehabCenter() {
  if (money >= 150) {
    money -= 150;
    rehabCount += 1;
    logMessage("Built a rehab center! Total: " + rehabCount);
    updateDisplay();
  } else {
    logMessage("Not enough money!");
  }
}

function runRehabEffects() {
  let rehabbed = 0;

  let successChance = (education + morale + homeLife) / 300;

  // Overcrowded prisons make rehab less effective
  if (prisoners > prisonCapacity) {
    successChance *= 0.5;
  }

  for (let i = 0; i < rehabCount; i++) {
    if (prisoners > 0 && Math.random() < successChance) {
      prisoners--;
      releasedPrisoners++;
      morale += 1;
      rehabbed++;
    }
  }

  if (rehabbed > 0) {
logMessage(`${rehabbed} prisoners rehabilitated and released.`);
  }
}

function checkReoffending() {
  if (homeLife < 40 || morale < 40) {
    let reoffendChance = Math.floor(Math.random() * 100);
    if (reoffendChance < 25 && releasedPrisoners > 0) {
      prisoners += 1;
      releasedPrisoners -= 1;
      logMessage("A released citizen re-offended and returned to prison.");
    }
    
  }
}
function payForPrisons() {
  money -= prisonCount * 10;
}



function clearLog() {
  document.getElementById("logMessages").innerHTML = "";
}






function triggerRandomBadEvent() {
  let events = [
    {
      title: "Flood Hits Farmland",
      description: "Heavy rains destroyed crops and damaged property.",
      options: [
        {
          text: "Pay for cleanup ($100)",
          action: function () {
            money -= 100;
            morale += 5;
          }
        },
        {
          text: "Ignore it",
          action: function () {
            morale -= 5;
            crime += 3;
          }
        }
      ]
    },
    {
      title: "Corruption Scandal",
      description: "A minor official stole funds. What do you do?",
      options: [
        {
          text: "Fire and investigate",
          action: function () {
            morale += 2;
            crime -= 3;
          }
        },
        {
          text: "Cover it up (no penalty)",
          action: function () {
            // nothing happens
          }
        },
        {
          text: "Blame someone else (morale -5)",
          action: function () {
            morale -= 5;
          }
        }
      ]
    }
  ];

  // You can now proceed to use `events` like normal


  let corruptionChance = Math.min(risk / 100, 0.5); // Max 50% chance
let roll = Math.random();

let event;

if (roll < corruptionChance) {
  event = events.find(e => e.title === "Corruption Scandal");
} else {
  // pick any non-corruption event
  let nonCorruptionEvents = events.filter(e => e.title !== "Corruption Scandal");
  event = nonCorruptionEvents[Math.floor(Math.random() * nonCorruptionEvents.length)];
}


  
  // Show the event panel with choices
  showEvent(event);
}


function showEvent(event) {
  // Show the event panel
  goTo("eventPanel");

  // Fill in title and description
  document.getElementById("eventTitle").textContent = event.title;
  document.getElementById("eventDescription").textContent = event.description;

  // Set up option buttons
  let options = event.options;

  document.getElementById("option1Btn").textContent = options[0].text;
  document.getElementById("option1Btn").onclick = function() {
    options[0].action();
    endEvent();
  };

  document.getElementById("option2Btn").textContent = options[1].text;
  document.getElementById("option2Btn").onclick = function() {
    options[1].action();
    endEvent();
  };

  // Optional 3rd option
  if (options[2]) {
    document.getElementById("option3Btn").style.display = "inline";
    document.getElementById("option3Btn").textContent = options[2].text;
    document.getElementById("option3Btn").onclick = function() {
      options[2].action();
      endEvent();
    };
  } else {
    document.getElementById("option3Btn").style.display = "none";
  }
}

function endEvent() {
  goTo("mainMenu"); // Or wherever you want to send the player
  updateDisplay();
}




function buildPrison() {
  if (money >= 200) {
    money -= 200;
    prisonCount += 1;
    prisonCapacity += 50;
    morale -= 3; // People don't like lots of prisons
    logMessage("You built a prison. Capacity increased, but morale dropped.");
    updateDisplay();
  } else {
    logMessage("Not enough money!");
  }
}

function updateCrimeEffects() {
  if (crime > 50) prisoners += 1;
}

function checkPrisonOvercrowding() {
  if (prisoners > prisonCapacity) {
    morale -= 5;
    logMessage("Prisons are overcrowded! Morale dropped.");
  }
}

function passiveMoraleDropFromPrisons() {
  morale -= prisonCount * 0.1;
}

function increaseRadicalization() {
  if (prisonCount > 3) {
    radicalization += prisonCount * 0.3;
  }
}



function applyRiskConsequences() {
  if (risk > 20) {
    morale -= 1;
  }
  if (risk > 40) {
    radicalization += 1;
  }
}

 


 function updateHomeLife() {
  let before = homeLife;

  if (morale > 60 && health > 60 && education > 60 && crime < 30) {
    homeLife += 1;
  }

  if (morale < 40 || health < 40 || crime > 60 || radicalization > 40) {
    homeLife -= 1;
  }
if (homeLife < 30) {
  radicalization += 1;
  logMessage("Worsening home conditions are feeding unrest.");
}
  // Clamp between 0 and 100
  if (homeLife < 0) homeLife = 0;
  if (homeLife > 100) homeLife = 100;

  // Optional pop-up message when it drops
  if (homeLife < before) {
    logMessage("Home Life worsened due to poor morale or conditions.");
  }
  if (homeLife > before) {
    logMessage("Home Life improved thanks to better morale and living conditions!");
  }
}

function sendWorkersAbroad() {
  if (population >= 5) {
    abroadWorkers += 5;
    population -= 5;
    morale -= 3;
    logMessage("You sent 5 citizens abroad to work. Money will come, but morale took a hit.");
    updateDisplay();
  } else {
    logMessage("Not enough people to send abroad.");
  }
}

function viewCitizens() {
  let output = citizens.map(c =>
    `${c.name} – ${c.role} – ${c.jailed ? "In Prison" : "Free"} – Morale: ${c.morale} – Radical: ${c.radicalization} – Wealth: ${c.wealth} – Home: ${c.homeLife}`
  ).join("<br>");
  document.getElementById("logMessages").innerHTML = output;
}
function displayCitizenLog(messages) {
  let log = document.getElementById("citizenLogMessages");
  log.innerHTML = messages.join("<br>");
}
function citizenTalkLog() {
  let messages = [];

  citizens.forEach(citizen => {
    if (citizen.jailed) {
      messages.push(`${citizen.name}: "There’s too many of us in this cell."`);
    } else if (citizen.abroad) {
      messages.push(`${citizen.name}: "I know my husband is working overseas for us, but I miss him."`);
    } else if (citizen.role === "Student" && citizen.morale > 60 && education > 60) {
      messages.push(`${citizen.name}: "Wow, I can’t believe I’m graduating!"`);
    } else if (citizen.radicalization > 50) {
      messages.push(`${citizen.name}: "The government wants us dead."`);
    } else if (citizen.homeLife < 40) {
      messages.push(`${citizen.name}: "Dad comes home drunk every week now."`);
    } else if (citizen.wealth > 50) {
      messages.push(`${citizen.name}: "I finally bought a new synth-bike."`);
    } else if (citizen.morale < 30) {
      messages.push(`${citizen.name}: "Why even try anymore?"`);
    }
  });

  displayCitizenLog(messages);
}


function placeSchool(index) {
  let n = neighborhoods[index];
  if (money >= 120) {
    money -= 120;
    n.buildings.push("school");
    schoolCount++;
    educationCapacity += 30;
    morale += 4;
    education += 10;
    if (n.type === "poor") education += 2;
    logMessage(`You built a school in ${n.name}.`);
    updateDisplay();
  } else {
    logMessage("Not enough money!");
  }
}

function placePrison(index) {
  let n = neighborhoods[index];
  if (money >= 200) {
    money -= 200;
    n.buildings.push("prison");
    prisonCount++;
    prisonCapacity += 50;
    morale -= 3;
    if (n.type === "poor") {
      morale -= 2;
      radicalization += 2;
    }
    if (n.type === "rich") {
      radicalization += 1;
    }
    logMessage(`You built a prison in ${n.name}.`);
    updateDisplay();
  } else {
    logMessage("Not enough money!");
  }
}

function placeClinic(index) {
  let n = neighborhoods[index];
  if (money >= 150) {
    money -= 150;
    n.buildings.push("clinic");
    clinicCount++;
    health += 10;
    morale += 3;
    if (n.type === "poor") health += 3;
    logMessage(`You built a clinic in ${n.name}.`);
    updateDisplay();
  } else {
    logMessage("Not enough money!");
  }
}

function placePark(index) {
  let n = neighborhoods[index];
  if (money >= 90) {
    money -= 90;
    n.buildings.push("park");
    morale += 5;
    homeLife += 2;
    logMessage(`You built a park in ${n.name}.`);
    updateDisplay();
  } else {
    logMessage("Not enough money!");
  }
}

function placeMuseum(index) {
  let n = neighborhoods[index];
  if (money >= 180) {
    money -= 180;
    n.buildings.push("museum");
    morale += 4;
    wealth += 4;
    education += 3;
    logMessage(`You built a museum in ${n.name}.`);
    updateDisplay();
  } else {
    logMessage("Not enough money!");
  }
}

function placeFactory(index) {
  let n = neighborhoods[index];
  if (money >= 200) {
    money -= 200;
    n.buildings.push("factory");
    factoryCount++;
    logMessage(`You built a factory in ${n.name}.`);
    updateDisplay();
  } else {
    logMessage("Not enough money!");
  }
}

function placeRehabCenter(index) {
  let n = neighborhoods[index];
  if (money >= 150) {
    money -= 150;
    n.buildings.push("rehab");
    rehabCount++;
    logMessage(`You built a rehab center in ${n.name}.`);
    updateDisplay();
  } else {
    logMessage("Not enough money!");
  }
}


function renderPlacementMenu(type) {
  let container = document.getElementById("placementMenu");
  container.innerHTML = `<h3>Select Neighborhood to place a ${type}</h3>`;

  neighborhoods.forEach((n, index) => {
    container.innerHTML += `<button onclick="place${type}(${index})">${n.name} (${n.type})</button><br>`;
  });
}



function updateCitizenStats() {
  citizens.forEach(c => {
    c.stats.morale = getStatNear(morale);
    c.stats.homeLife = getStatNear(homeLife);
    c.stats.radicalization = getStatNear(radicalization);
    c.stats.education = getStatNear(education);
    c.stats.health = getStatNear(health);
  });
}

function getStatNear(cityStat) {
  let variance = Math.floor(Math.random() * 5) - 2; // -2 to +2
  return Math.max(0, Math.min(100, cityStat + variance));
}


function renderCitizenProfile(index) {
  const citizen = citizens[index];
  let html = `
    <h2>${citizen.name}</h2>
    <img src="${citizen.image}" style="width:100px;height:auto;">
    <p><em>${citizen.bio}</em></p>
    <p><strong>Tags:</strong> ${citizen.tags.join(", ")}</p>
    <ul>
      <li>Morale: ${citizen.stats.morale}</li>
      <li>Home Life: ${citizen.stats.homeLife}</li>
      <li>Radicalization: ${citizen.stats.radicalization}</li>
      <li>Education: ${citizen.stats.education}</li>
      <li>Health: ${citizen.stats.health}</li>
    </ul>
    <button onclick="renderCitizenList()">Back to Citizens</button>
  `;
  document.getElementById("citizenContent").innerHTML = html;
}


function renderCitizenList() {
  goTo("citizenScreen");
  let html = "<h2>Citizens</h2>";
  citizens.forEach((c, index) => {
    html += `<button onclick="renderCitizenProfile(${index})">${c.name}</button><br>`;
  });
  html += `<br><button onclick="goTo('mainMenu')">Back</button>`;
  document.getElementById("citizenContent").innerHTML = html;
}

function updateRiskFromFactors() {
  // Example logic: risk increases if corruption or too many desperation actions
  if (morale < 40) risk += 0.3;
  if (radicalization > 50) risk += 0.5;
  if (money > 1000) risk -= 0.2; // financial stability lowers risk
  if (health < 40) risk += 0.3;

  // Clamp
  if (risk < 0) risk = 0;
  if (risk > 100) risk = 100;

  if (risk > 50) {
  radicalization += 2; // ← this is for radicalization
}

}


function renderNeighborhoodSummary() {
  let html = "<h2>Neighborhood Overview</h2>";
  neighborhoods.forEach(n => {
    html += `<p><strong>${n.name}</strong> (${n.class})<br>`;
    html += `Schools: ${n.schools || 0}, Prisons: ${n.prisons || 0}, Parks: ${n.parks || 0}, Museums: ${n.museums || 0}</p>`;
  });
  html += `<br><button onclick="goTo('mainMenu')">Back</button>`;
  document.getElementById("app").innerHTML = html;
}






function gameTick() {
  
  updateCrimeEffects();
  checkPrisonOvercrowding();
  passiveMoraleDropFromPrisons();
 
  updateHomeLife();
  updateRiskFromFactors() 
 
  generateFarmIncome(); // ✅ just call it here
  updateEducation(); // ⬅️ new line
citizenTalkLog();

payForPrisons();
checkClinicCapacity();
generateFactoryIncome();

applyRiskConsequences();
money += abroadWorkers * 10; // each brings $10 per tick
morale -= abroadWorkers * 0.05; // passive morale penalty if too many are gone
empowerment = Math.floor(morale * 0.1);
if (morale < 20 && wealth < 30) {
  radicalization += 2;
  logMessage("Desperation is turning into resistance.");
}
// === RISK DYNAMICS ===
if (crime > 60) risk += 1;
if (education < 40) risk += 0.5;
if (morale < 30) risk += 1;
if (radicalization > 50) risk += 2;
if (wealth > 70 && homeLife > 70) risk += 1; // spoiled rich syndrome
if (prisonCount > 5 && homeLife < 50) risk += 2; // oppressive justice system

// Risk reducers
if (stabilityResearch > 0) risk -= 1;
if (education > 70 && morale > 70 && homeLife > 70) risk -= 1.5;
if (empowerment > 10) risk -= 0.5;

if (risk < 0) risk = 0;
if (risk > 100) risk = 100;

if (empowerment > 0) {
  education += Math.floor(empowerment * 0.01);  // +1 per 100
  health += Math.floor(empowerment * 0.01);
  wealth += Math.floor(empowerment * 0.01);
  crime -= Math.floor(empowerment * 0.01); // less crime thanks to community agency
  logMessage("Empowered citizens are improving society.");
}
 
 
  updateDisplay();
}




 
  </script>
</body>
</html>
